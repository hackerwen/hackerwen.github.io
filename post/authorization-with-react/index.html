<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>åŸºäºReactçš„æƒé™ç³»ç»Ÿè®¾è®¡ | æµ·ç§‹</title>
<meta name="description" content="æ•…äººåƒä¸‡é‡Œï¼Œæ–°è‰ä¸‰ä¸¤å£°ã€‚" />
<link rel="shortcut icon" href="https://worldzhao.github.io/favicon.ico?v=1569412952519">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://worldzhao.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://worldzhao.github.io">
  <img class="avatar" src="https://worldzhao.github.io/images/avatar.png?v=1569412952519" alt="">
  </a>
  <h1 class="site-title">
    æµ·ç§‹
  </h1>
  <p class="site-description">
    æ•…äººåƒä¸‡é‡Œï¼Œæ–°è‰ä¸‰ä¸¤å£°ã€‚
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/worldzhao" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
    
      
    
      
        <a href="https://www.zhihu.com/people/zhao-qing-90-84/activities" target="_blank">
          <i class="fab fa-zhihu"></i>
        </a>
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              åŸºäºReactçš„æƒé™ç³»ç»Ÿè®¾è®¡
            </h2>
            <div class="post-info">
              <span>
                2019-09-25
              </span>
              <span>
                10 min read
              </span>
              
                <a href="https://worldzhao.github.io/tag/S1yumrohX8" class="post-tag">
                  # react
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6hx2xoodpj31900u07mv.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>å‰ç«¯è¿›è¡Œæƒé™æ§åˆ¶åªæ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå¯¹åº”çš„è§’è‰²æ¸²æŸ“å¯¹åº”çš„è§†å›¾ï¼ŒçœŸæ­£çš„å®‰å…¨ä¿éšœåœ¨åç«¯ã€‚</p>
<!-- more -->
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ¯•ä¸šä¹‹åˆï¼Œå·¥ä½œçš„ä¸»è¦å†…å®¹ä¾¿æ˜¯å¼€å‘ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œå½“æ—¶å­˜åœ¨çš„ä¸€ä¸ªç°è±¡æ˜¯ï¼š</p>
<p><strong>ç”¨æˆ·è‹¥è®°ä½äº†æŸä¸ª urlï¼Œç›´æ¥æµè§ˆå™¨è¾“å…¥ï¼Œä¸è®ºè¯¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®è¯¥é¡µé¢çš„æƒé™ï¼Œå‡èƒ½è¿›å…¥é¡µé¢ã€‚</strong></p>
<p>è‹¥é¡µé¢åˆå§‹åŒ–æ—¶ï¼ˆ<code>componentDidMount</code>ï¼‰è¿›è¡Œæ¥å£è¯·æ±‚ï¼Œåç«¯ä¼šè¿”å› 403 çš„ HTTP çŠ¶æ€ç ï¼ŒåŒæ—¶å‰ç«¯å°è£…çš„<code>request.js</code>ä¼šå¯¹éä¸šåŠ¡å¼‚å¸¸è¿›è¡Œç›¸å…³å¤„ç†ï¼Œé‡è§ 403ï¼Œå°±é‡å®šå‘åˆ°æ— æƒé™é¡µé¢ã€‚</p>
<p>è‹¥æ˜¯é¡µé¢åˆå§‹åŒ–æ—¶ä¸å­˜åœ¨å‰åç«¯äº¤äº’ï¼Œé‚£å°±è¦ç­‰ç”¨æˆ·è§¦å‘æŸäº›æ“ä½œï¼ˆæ¯”å¦‚è¡¨å•æäº¤ï¼‰åæ‰ä¼šè§¦å‘ä¸Šè¿°æµç¨‹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®‰å…¨ä¿éšœæ˜¯åç«¯å…œåº•çš„ï¼Œé‚£å‰ç«¯èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ol>
<li>æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œé¿å…ç”¨æˆ·è¯¯ä»¥ä¸ºè‡ªå·±æ‹¥æœ‰è¯¥æƒé™è€Œè¿›è¡Œæ“ä½œï¼ˆå³ä½¿æ— æ³•æ“ä½œæˆåŠŸï¼‰ï¼Œç›´æ¥è·³è½¬è‡³æ— æƒé™é¡µé¢ï¼›</li>
<li>æ‹¦æˆªæ˜ç¡®æ— æƒçš„è¯·æ±‚ï¼Œæ¯”å¦‚æŸäº›éœ€è¦æƒé™æ‰èƒ½è¿›è¡Œçš„æ“ä½œå…¥å£ï¼ˆæŒ‰é’® or å¯¼èˆªç­‰ï¼‰ä¸å¯¹æ— æƒç”¨æˆ·å±•ç¤ºï¼Œå…¶å®æœ¬ç‚¹åŒ…å«ä¸Šä¸€ç‚¹ã€‚</li>
</ol>
<p>æœ€è¿‘ä¹Ÿåœ¨çœ‹<code>Ant Design Pro</code>çš„æƒé™ç›¸å…³å¤„ç†ï¼Œæœ‰å¿…è¦è¿›è¡Œä¸€æ¬¡æ€»ç»“ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ–‡è™½ç„¶åŸºäº<code>Ant Design Pro</code>çš„æƒé™è®¾è®¡æ€è·¯ï¼Œä½†å¹¶ä¸æ˜¯å®Œå…¨å¯¹å…¶æºç çš„è§£è¯»ï¼ˆå¯èƒ½æ›´åå‘äº v1 çš„æ¶‰åŠæ€è·¯ï¼Œä¸æ¶‰åŠ umiï¼‰ã€‚</p>
<blockquote>
<p><code>Ant Design Pro</code>ä» v2 å¼€å§‹åº•å±‚åŸºäº <code>umi</code>å®ç°ï¼Œé€šè¿‡è·¯ç”±é…ç½®çš„ <code>Routes</code> å±æ€§ï¼Œç»“åˆ<code>@/pages/Authorized</code>ç»„ä»¶ï¼ˆè¯¥ç»„ä»¶åŸºäº<code>@/utils/Authorized</code>ç»„ä»¶â€”â€”<code>@/components/Authorized</code>çš„äºŒæ¬¡å°è£…ï¼Œæ³¨å…¥<code>currentAuthority</code>ï¼ˆå½“å‰æƒé™ï¼‰ï¼‰å®ç°ä¸»è¦æµç¨‹ã€‚ åŒæ—¶ï¼Œæƒé™ä¿¡æ¯å­˜æ”¾äº<code>localStorage</code>ï¼Œé€šè¿‡<code>@/utils/authority.js</code>æä¾›çš„å·¥å…·æ–¹æ³•è¿›è¡Œæƒé™ <code>get</code> ä»¥åŠ <code>set</code>ã€‚</p>
</blockquote>
<blockquote>
<p>ä»”ç»†çœ‹äº†ä¸‹<code>@/components/Authorized</code>æ–‡ä»¶ä¸‹çš„å†…å®¹ï¼Œå‘ç°è¿˜æä¾›äº†<code>AuthorizedRoute</code>ç»„ä»¶ï¼Œä½†æ˜¯å¹¶æœªåœ¨ä»£ç ä¸­ä½¿ç”¨ï¼ˆå–è€Œä»£ä¹‹çš„æ˜¯<code>@/pages/Authorized</code>ç»„ä»¶ï¼‰ï¼Œç¿»äº† issue æ‰äº†è§£åˆ°ï¼Œv1 æ²¡æœ‰åŸºäº<code>umi</code>çš„æ—¶å€™ï¼Œæ˜¯åŸºäº<code>AuthorizedRoute</code>è¿›è¡Œè·¯ç”±æƒé™ç®¡ç†çš„ï¼Œå‡çº§äº†ä¹‹åï¼Œ<code>AuthorizedRoute</code>åˆ™å¹¶æ²¡æœ‰ç”¨äºè·¯ç”±æƒé™ç®¡ç†ã€‚</p>
</blockquote>
<blockquote>
<p>æ¶‰åŠåˆ°çš„ç›¸å…³æ–‡ä»¶æ¯”è¾ƒå¤šï¼ˆcomponents/pages/utilsï¼‰ï¼Œv4 çš„æ–‡æ¡£åˆæœ‰äº›ç¼ºå¤±ï¼Œçœ‹æºç çš„è¯ï¼Œè‹¥æ²¡æœ‰ç†æ¸…ç‰ˆæœ¬ä¹‹é—´å·®å¼‚ï¼Œç€å®ä¼šæœ‰äº›è´¹åŠ›ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡åœ¨æƒé™ä¿¡æ¯è·å–ä¸Šï¼Œé€šè¿‡æ¥å£å¼‚æ­¥è·å–ï¼Œå­˜æ”¾è‡³ reduxï¼ˆå’Œ v4 ç‰ˆæœ¬æœ‰äº›ç±»ä¼¼ï¼Œè§<code>@/pages/Authorized</code>ä»¥åŠ<code>@/layouts/SecurityLayout</code>ï¼‰ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å®Œå…¨ä»é›¶å¼€å§‹ï¼ŒğŸ‘† ä¸€å¤§æ®µå¾ˆç»•ï¼Œä½†æ˜¯ä¸€ç‚¹å½±å“éƒ½æ²¡æœ‰ï¼åªæ˜¯æˆ‘è‡ªå·±çš„ä¸€äº›æ¢³ç†ï¼Œå¯ç•¥è¿‡ã€‚</p>
<p>å¦‚æœæœ‰é”™è¯¯ä»¥åŠç†è§£åå·®è¯·è½»æ¶å¹¶æŒ‡æ­£ï¼Œè°¢è°¢ã€‚</p>
<h2 id="æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†">æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†</h2>
<p>å‡è®¾å­˜åœ¨ä»¥ä¸‹å…³ç³»ï¼š</p>
<table>
<thead>
<tr>
<th>è§’è‰² role</th>
<th>æƒé™æšä¸¾å€¼ authority</th>
<th>é€»è¾‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šç”¨æˆ·</td>
<td>user</td>
<td>ä¸å±•ç¤º</td>
</tr>
<tr>
<td>ç®¡ç†å‘˜</td>
<td>admin</td>
<td>å±•ç¤ºâ€œè¿›å…¥ç®¡ç†åå°â€æŒ‰é’®</td>
</tr>
</tbody>
</table>
<p>æŸé¡µé¢ä¸Šå­˜åœ¨ä¸€ä¸ªæ–‡æ¡ˆä¸ºâ€œè¿›å…¥ç®¡ç†åå°â€çš„æŒ‰é’®ï¼Œåªå¯¹ç®¡ç†å‘˜å±•ç¤ºï¼Œè®©æˆ‘ä»¬å®ç°ä¸€ä¸‹ã€‚</p>
<h3 id="ç®€å•å®ç°">ç®€å•å®ç°</h3>
<pre><code class="language-jsx">// currentAuthority ä¸ºå½“å‰ç”¨æˆ·æƒé™æšä¸¾å€¼

const AdminBtn = ({ currentAuthority }) =&gt; {
  if (&quot;admin&quot; === currentAuthority) {
    return &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;;
  }
  return null;
};
</code></pre>
<p>å¥½å§ï¼Œç®€å•è‡³æã€‚</p>
<p>æƒé™æ§åˆ¶å°±æ˜¯<code>if else</code>ï¼Œå®ç°åŠŸèƒ½å¹¶ä¸å¤æ‚ï¼Œå¤§ä¸äº†æ¯ä¸ªé¡µé¢|æ¨¡å—|æŒ‰é’®æ¶‰åŠåˆ°çš„å¤„ç†éƒ½å†™ä¸€éåˆ¤æ–­å°±æ˜¯äº†ï¼Œæ€»èƒ½å®ç°éœ€æ±‚çš„ã€‚</p>
<p>ä¸è¿‡ï¼Œç°åœ¨åªæ˜¯ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæŒ‰é’®è€Œå·²ï¼Œæˆ‘ä»¬è¿˜ä¼šç¢°åˆ°è®¸å¤šâ€œæŸï¼ˆå‡ ï¼‰ä¸ªé¡µé¢å­˜åœ¨æŸä¸ª xxxï¼Œåªå¯¹ xxxï¼ˆæˆ–/ä»¥åŠ xxxï¼‰ å±•ç¤ºâ€çš„åœºæ™¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿˜èƒ½åšçš„æ›´å¥½ä¸€äº›ã€‚</p>
<p>ä¸‹é¢æ¥å°è£…ä¸€ä¸ªæœ€åŸºæœ¬çš„æƒé™ç®¡ç†ç»„ä»¶<code>Authorized</code>ã€‚</p>
<h3 id="ç»„ä»¶å°è£…-authorized">ç»„ä»¶å°è£…-Authorized</h3>
<p>æœŸæœ›è°ƒç”¨å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">&lt;Authorized
  currentAuthority={currentAuthority}
  authority={&quot;admin&quot;}
  noMatch={null}
&gt;
  &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;
&lt;/Authorized&gt;
</code></pre>
<p>api å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç±»å‹</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>children</td>
<td>æ­£å¸¸æ¸²æŸ“çš„å…ƒç´ ï¼Œæƒé™åˆ¤æ–­é€šè¿‡æ—¶å±•ç¤º</td>
<td></td>
<td>ReactNode</td>
</tr>
<tr>
<td>currentAuthority</td>
<td>å½“å‰æƒé™</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>authority</td>
<td>å‡†å…¥æƒé™</td>
<td>string/string[]</td>
<td></td>
</tr>
<tr>
<td>noMatch</td>
<td>æœªé€šè¿‡æƒé™åˆ¤æ–­æ—¶å±•ç¤º</td>
<td>ReactNode</td>
<td></td>
</tr>
</tbody>
</table>
<p><code>currentAuthority</code>è¿™ä¸ªå±æ€§æ²¡æœ‰å¿…è¦æ¯æ¬¡è°ƒç”¨éƒ½æ‰‹åŠ¨ä¼ é€’ä¸€éï¼Œæ­¤å¤„å‡è®¾ç”¨æˆ·ä¿¡æ¯æ˜¯é€šè¿‡ <code>redux</code> è·å–å¹¶å­˜æ”¾åœ¨å…¨å±€ <code>store</code> ä¸­ã€‚</p>
<p><em>æ³¨æ„ï¼šæˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯æŒ‚åœ¨ <code>window</code> ä¸‹æˆ–è€… <code>localStorage</code> ä¸­ï¼Œä½†å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œç»å¤§éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ¥å£å¼‚æ­¥è·å–çš„æ•°æ®ï¼Œè¿™ç‚¹è‡³å…³é‡è¦ã€‚å¦‚æœæ˜¯ <code>html</code> æ‰˜ç®¡åœ¨åç«¯æˆ–æ˜¯ <code>ssr</code>çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯ç›´æ¥æ³¨å…¥äº†ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£çœŸæ˜¯å†å¥½ä¸è¿‡äº†ã€‚</em></p>
<p>æ–°å»º<code>src/components/Authorized/Authorized.jsx</code>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import { connect } from &quot;react-redux&quot;;

function Authorized(props) {
  const { children, userInfo, authority, noMatch } = props;
  const { currentAuthority } = userInfo || {};
  if (!authority) return children;
  const _authority = Array.isArray(authority) ? authority : [authority];
  if (_authority.includes(currentAuthority)) return children;
  return noMatch;
}

export default connect(store =&gt; ({ userInfo: store.common.userInfo }));
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨ä¼ é€’<code>currentAuthority</code>ï¼š</p>
<pre><code class="language-jsx">&lt;Authorized authority={&quot;admin&quot;} noMatch={null}&gt;
  &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;
&lt;/Authorized&gt;
</code></pre>
<p>âœ¨ å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥ã€‚</p>
<blockquote>
<p>åœ¨<code>Ant Design Pro</code>ä¸­ï¼Œå¯¹äº<code>currentAuthority</code>ï¼ˆå½“å‰æƒé™ï¼‰ä¸<code>authority</code>ï¼ˆå‡†å…¥æƒé™ï¼‰çš„åŒ¹é…åŠŸèƒ½ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>checkPermissions</code>æ–¹æ³•ï¼Œæä¾›äº†å„ç§å½¢å¼çš„åŒ¹é…ï¼Œæœ¬æ–‡åªè®¨è®º<code>authority</code>ä¸ºæ•°ç»„ï¼ˆå¤šä¸ªå‡†å…¥æƒé™ï¼‰æˆ–å­—ç¬¦ä¸²ï¼ˆå•ä¸ªå‡†å…¥æƒé™ï¼‰ï¼Œ<code>currentAuthority</code>ä¸ºå­—ç¬¦ä¸²ï¼ˆå½“å‰è§’è‰²åªæœ‰ä¸€ç§æƒé™ï¼‰çš„æƒ…å†µã€‚</p>
</blockquote>
<h2 id="é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†">é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†</h2>
<p><strong>é¡µé¢å°±æ˜¯æ”¾åœ¨<code>Route</code>ç»„ä»¶ä¸‹çš„æ¨¡å—ã€‚</strong></p>
<p>çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å¾ˆè½»æ¾çš„å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p>
<p>æ–°å»º<code>src/router/index.jsx</code>ï¼Œå½“ç”¨æˆ·è§’è‰²ä¸è·¯ç”±ä¸åŒ¹é…æ—¶ï¼Œæ¸²æŸ“<code>Redirect</code>ç»„ä»¶ç”¨äºé‡å®šå‘ã€‚</p>
<pre><code class="language-jsx">import React from &quot;react&quot;;
import { BrowserRouter, Route, Switch } from &quot;react-router-dom&quot;;
import NormalPage from &quot;@/views/NormalPage&quot;; /* å…¬å¼€é¡µé¢ */
import UserPage from &quot;@/views/UserPage&quot;; /* æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜å‡å¯è®¿é—®çš„é¡µé¢*/
import AdminPage from &quot;@/views/AdminPage&quot;; /* ç®¡ç†å‘˜æ‰å¯è®¿é—®çš„é¡µé¢*/
import Authorized from &quot;@/components/Authorized&quot;;

// Layoutå°±æ˜¯ä¸€ä¸ªå¸ƒå±€ç»„ä»¶ï¼Œå†™ä¸€äº›å…¬ç”¨å¤´éƒ¨åº•éƒ¨å•¥çš„

function Router() {
  &lt;BrowserRouter&gt;
    &lt;Layout&gt;
      &lt;Switch&gt;
        &lt;Route exact path=&quot;/&quot; component={NormalPage} /&gt;

        &lt;Authorized
          authority={[&quot;admin&quot;, &quot;user&quot;]}
          noMatch={
            &lt;Route
              path=&quot;/admin-page&quot;
              render={() =&gt; &lt;Redirect to={{ pathname: &quot;/login&quot; }} /&gt;}
            /&gt;
          }
        &gt;
          &lt;Route path=&quot;/user-page&quot; component={UserPage} /&gt;
        &lt;/Authorized&gt;

        &lt;Authorized
          authority={&quot;admin&quot;}
          noMatch={
            &lt;Route
              path=&quot;/admin-page&quot;
              render={() =&gt; &lt;Redirect to={{ pathname: &quot;/403&quot; }} /&gt;}
            /&gt;
          }
        &gt;
          &lt;Route path=&quot;/admin-page&quot; component={AdminPage} /&gt;
        &lt;/Authorized&gt;
      &lt;/Switch&gt;
    &lt;/Layout&gt;
  &lt;/BrowserRouter&gt;;
}

export default Router;
</code></pre>
<p>è¿™æ®µä»£ç æ˜¯ä¸ work çš„ï¼Œå› ä¸ºå½“å‰æƒé™ä¿¡æ¯æ˜¯é€šè¿‡æ¥å£å¼‚æ­¥è·å–çš„ï¼Œæ­¤æ—¶<code>Authorized</code>ç»„ä»¶è·å–ä¸åˆ°å½“å‰æƒé™ï¼ˆ<code>currentAuthority</code>ï¼‰ï¼Œå€˜è‹¥ç›´æ¥é€šè¿‡ url è®¿é—®<code>/user-page</code>æˆ–<code>/admin-page</code>ï¼Œä¸è®ºç”¨æˆ·èº«ä»½æ˜¯å¦ç¬¦åˆï¼Œè¯·æ±‚ç»“æœæœªå›æ¥ï¼Œéƒ½ä¼šè¢«é‡å®šå‘åˆ°<code>/login</code>æˆ–<code>/403</code>ï¼Œè¿™ä¸ªé—®é¢˜åé¢å†è°ˆã€‚</p>
<p>å…ˆä¼˜åŒ–ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚</p>
<h3 id="æŠ½ç¦»è·¯ç”±é…ç½®">æŠ½ç¦»è·¯ç”±é…ç½®</h3>
<p>è·¯ç”±é…ç½®ç›¸å…³ jsx å†…å®¹å¤ªå¤šäº†ï¼Œé¡µé¢æ•°é‡è¿‡å¤šå°±ä¸å¥½ç»´æŠ¤äº†ï¼Œå¯è¯»æ€§ä¹Ÿå¤§å¤§é™ä½ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¯ç”±é…ç½®æŠ½ç¦»å‡ºæ¥ã€‚</p>
<p>æ–°å»º<code>src/router/router.config.js</code>ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾è·¯ç”±ç›¸å…³é…ç½®ä¿¡æ¯ã€‚</p>
<pre><code class="language-jsx">import NormalPage from &quot;@/views/NormalPage&quot;;
import UserPage from &quot;@/views/UserPage&quot;;
import AdminPage from &quot;@/views/AdminPage&quot;;

export default [
  {
    exact: true,
    path: &quot;/&quot;,
    component: NormalPage
  },
  {
    path: &quot;/user-page&quot;,
    component: UserPage,
    authority: [&quot;user&quot;, &quot;admin&quot;],
    redirectPath: &quot;/login&quot;
  },
  {
    path: &quot;/admin-page&quot;,
    component: AdminPage,
    authority: [&quot;admin&quot;],
    redirectPath: &quot;/403&quot;
  }
];
</code></pre>
<h3 id="ç»„ä»¶å°è£…-authorizedroute">ç»„ä»¶å°è£…-AuthorizedRoute</h3>
<p>æ¥ä¸‹æ¥åŸºäº<code>Authorized</code>ç»„ä»¶å¯¹<code>Route</code>ç»„ä»¶è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚</p>
<p>æ–°å»º<code>src/components/Authorized/AuthorizedRoute.jsx</code>ã€‚</p>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import React from &quot;react&quot;;
import { Route } from &quot;react-router-dom&quot;;
import Authorized from &quot;./Authorized&quot;;

function AuthorizedRoute({
  component: Component,
  render,
  authority,
  redirectPath,
  ...rest
}) {
  return (
    &lt;Authorized
      authority={authority}
      noMatch={
        &lt;Route
          {...rest}
          render={() =&gt; &lt;Redirect to={{ pathname: redirectPath }} /&gt;}
        /&gt;
      }
    &gt;
      &lt;Route
        {...rest}
        render={props =&gt; (Component ? &lt;Component {...props} /&gt; : render(props))}
      /&gt;
    &lt;/Authorized&gt;
  );
}

export default AuthorizedRoute;
</code></pre>
<h3 id="ä¼˜åŒ–å">ä¼˜åŒ–å</h3>
<p>ç°åœ¨é‡å†™æˆ‘ä»¬çš„ Router ç»„ä»¶ã€‚</p>
<pre><code class="language-jsx">import React from &quot;react&quot;;
import { BrowserRouter, Route, Switch } from &quot;react-router-dom&quot;;
import AuthorizedRoute from &quot;@/components/AuthorizedRoute&quot;;
import routeConfig from &quot;./router.config.js&quot;;

function Router() {
  &lt;BrowserRouter&gt;
    &lt;Layout&gt;
      &lt;Switch&gt;
        {routeConfig.map(rc =&gt; {
          const { path, component, authority, redirectPath, ...rest } = rc;
          return (
            &lt;AuthorizedRoute
              key={path}
              path={path}
              component={component}
              authority={authority}
              redirectPath={redirectPath}
              {...rest}
            /&gt;
          );
        })}
      &lt;/Switch&gt;
    &lt;/Layout&gt;
  &lt;/BrowserRouter&gt;;
}

export default Router;
</code></pre>
<p>å¿ƒæƒ…èˆ’ç•…äº†è®¸å¤šã€‚</p>
<p>å¯æ˜¯è¿˜ç•™ç€ä¸€ä¸ªé—®é¢˜å‘¢â€”â€”ç”±äºç”¨æˆ·æƒé™ä¿¡æ¯æ˜¯å¼‚æ­¥è·å–çš„ï¼Œåœ¨æƒé™ä¿¡æ¯æ•°æ®è¿”å›ä¹‹å‰ï¼Œ<code>AuthorizedRoute</code>ç»„ä»¶å°±å°†ç”¨æˆ·æ¨åˆ°äº†<code>redirectPath</code>ã€‚</p>
<blockquote>
<p>å…¶å®<code>Ant Design Pro</code> v4 ç‰ˆæœ¬å°±æœ‰å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œç›¸è¾ƒäº v2 çš„<code>@/pages/Authorized</code>ç»„ä»¶ä»<code>localStorage</code>ä¸­è·å–æƒé™ä¿¡æ¯ï¼Œv4 æ”¹ä¸ºä» redux ä¸­è·å–ï¼ˆredux ä¸­çš„æ•°æ®åˆ™æ˜¯é€šè¿‡æ¥å£è·å–ï¼‰ï¼Œå’Œæœ¬æ–‡æ¯”è¾ƒç±»ä¼¼ã€‚å…·ä½“å¯è§<a href="https://github.com/ant-design/ant-design-pro/pull/5088">æ­¤æ¬¡ PR</a>ã€‚</p>
</blockquote>
<h3 id="å¼‚æ­¥è·å–æƒé™">å¼‚æ­¥è·å–æƒé™</h3>
<p>è§£å†³æ€è·¯å¾ˆç®€å•ï¼šä¿è¯ç›¸å…³æƒé™ç»„ä»¶æŒ‚è½½æ—¶ï¼Œredux ä¸­å·²ç»å­˜åœ¨ç”¨æˆ·æƒé™ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ¥å£æ•°æ®è¿”å›åï¼Œå†è¿›è¡Œç›¸å…³æ¸²æŸ“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ Layout ä¸­è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„è·å–ï¼Œæ•°æ®è·å–å®Œæ¯•åæ¸²æŸ“<code>children</code>ã€‚</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97%E7%BA%A7%E5%88%AB%E7%9A%84%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86">æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†</a>
<ul>
<li><a href="#%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0">ç®€å•å®ç°</a></li>
<li><a href="#%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-authorized">ç»„ä»¶å°è£…-Authorized</a></li>
</ul>
</li>
<li><a href="#%E9%A1%B5%E9%9D%A2%E7%BA%A7%E5%88%AB%E7%9A%84%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86">é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†</a>
<ul>
<li><a href="#%E6%8A%BD%E7%A6%BB%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE">æŠ½ç¦»è·¯ç”±é…ç½®</a></li>
<li><a href="#%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-authorizedroute">ç»„ä»¶å°è£…-AuthorizedRoute</a></li>
<li><a href="#%E4%BC%98%E5%8C%96%E5%90%8E">ä¼˜åŒ–å</a></li>
<li><a href="#%E5%BC%82%E6%AD%A5%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90">å¼‚æ­¥è·å–æƒé™</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://worldzhao.github.io/post/thinking-in-deploy">
              <h3 class="post-title">
                å…³äºå‰ç«¯é¡¹ç›®éƒ¨ç½²å‘å¸ƒçš„ç›¸å…³æ€è€ƒ
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'ae70790f8df61d7ce952',
    clientSecret: 'dba663050bbe1ab7a23296198c9728128461dc35',
    repo: 'worldzhao.github.io',
    owner: 'worldzhao',
    admin: ['worldzhao'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://worldzhao.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
